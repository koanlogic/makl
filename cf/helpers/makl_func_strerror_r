#
# $Id: makl_func_strerror_r,v 1.4 2005/09/29 12:01:20 stewy Exp $
#

#\brief Define HAVE_STRERROR_R if strerror_r() is found, and STRERROR_R_CHAR_P
#       if it returns a char pointer (returns int on some systems).
#
makl_func_strerror_r ()
{
    [ -z `makl_get "__noconfig__"` ] || return

    makl_dbg "checking for function 'strerror_r'"

    # test function compilation 
    echo "
        char buf[100];
        strerror_r(0, buf, sizeof(buf));
    " | makl_compile_code 1

    if [ $? = 0 ]; then
        
        # Determine whether strerror_r returns a char* or an int by forcing a
        # char* return value with extern() and using isalpha() on the returned string.
        # A bus error may be caused if the return value is not a string.
        echo "
            extern char *strerror_r();
        
            int main() {
                char buf[100];
                char x = *strerror_r(0, buf, sizeof(buf));
                return (!isalpha(x));
            }
        " | makl_exec_code 0

        if [ $? = 0 ]; then
            makl_set_var_h "STRERROR_R_CHAR_P"
        fi

        makl_set_var_h "HAVE_STRERROR_R"

    else
        makl_err 2 "failed check on function 'strerror_r'!"
    fi
}
